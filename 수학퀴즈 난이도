var gameRoom = null;
var gameAnswer = null;
var gameDifficulty = null;

function response(room, msg, sender, isGroupChat, replier) {
    if (msg.startsWith('.ìˆ˜í•™í€´ì¦ˆ') && gameRoom === null) {
        var difficulty = msg.split(' ')[1];
        if (!['ì‰¬ì›€', 'ë³´í†µ', 'ì–´ë ¤ì›€', 'ê·¹ì•…'].includes(difficulty)) {
            replier.reply("ë‚œì´ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”: .ìˆ˜í•™í€´ì¦ˆ [ì‰¬ì›€/ë³´í†µ/ì–´ë ¤ì›€/ê·¹ì•…]");
            return;
        }
        
        gameRoom = room;
        gameDifficulty = difficulty;
        
        var question = generateQuestion(difficulty);
        replier.reply("ë‚œì´ë„: " + difficulty + "\n" + question + " = ?\në‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        
        // 30ì´ˆ íƒ€ì´ë¨¸ ì„¤ì •
        java.lang.Thread({
            run: function() {
                java.lang.Thread.sleep(30000);
                if (gameRoom !== null) {
                    replier.reply("ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ì •ë‹µì€ " + gameAnswer + "ì…ë‹ˆë‹¤.");
                    resetGame();
                }
            }
        }).start();
    } else if (gameRoom === room && gameAnswer !== null) {
        var userAnswer = parseFloat(msg);
        if (!isNaN(userAnswer)) {
            if (Math.abs(userAnswer - gameAnswer) < 0.01) {
                replier.reply("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘");
            } else {
                replier.reply("í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ " + gameAnswer + "ì…ë‹ˆë‹¤.");
            }
            resetGame();
        }
    }
}

function generateQuestion(difficulty) {
    var operators = ['+', '-', '*', '/'];
    var num1, num2, operator;
    
    switch(difficulty) {
        case 'ì‰¬ì›€':
            num1 = Math.floor(Math.random() * 10) + 1;
            num2 = Math.floor(Math.random() * 10) + 1;
            operator = operators[Math.floor(Math.random() * 2)];  // ë§ì…ˆ, ëº„ì…ˆë§Œ
            break;
        case 'ë³´í†µ':
            num1 = Math.floor(Math.random() * 50) + 1;
            num2 = Math.floor(Math.random() * 50) + 1;
            operator = operators[Math.floor(Math.random() * 4)];  // ëª¨ë“  ì—°ì‚°
            break;
        case 'ì–´ë ¤ì›€':
            num1 = Math.floor(Math.random() * 100) + 1;
            num2 = Math.floor(Math.random() * 100) + 1;
            operator = operators[Math.floor(Math.random() * 4)];
            break;
        case 'ê·¹ì•…':
            num1 = Math.floor(Math.random() * 1000) + 1;
            num2 = Math.floor(Math.random() * 100) + 1;
            operator = operators[Math.floor(Math.random() * 4)];
            break;
    }
    
    var question;
    switch(operator) {
        case '+':
            question = num1 + " + " + num2;
            gameAnswer = num1 + num2;
            break;
        case '-':
            question = num1 + " - " + num2;
            gameAnswer = num1 - num2;
            break;
        case '*':
            question = num1 + " Ã— " + num2;
            gameAnswer = num1 * num2;
            break;
        case '/':
            gameAnswer = num1;
            num1 = num1 * num2;  // ì •ìˆ˜ ë‚˜ëˆ—ì…ˆì„ ìœ„í•´
            question = num1 + " Ã· " + num2;
            break;
    }
    
    return question;
}

function resetGame() {
    gameRoom = null;
    gameAnswer = null;
    gameDifficulty = null;
}
